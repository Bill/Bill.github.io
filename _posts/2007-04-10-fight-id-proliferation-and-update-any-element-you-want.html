---
layout: post
title: Fight id Proliferation and Update Any Element You Want
date: 2007-04-10 12:07:52.000000000 -07:00
type: post
published: true
status: publish
categories:
- AJAX
- Ruby on Rails
- script.aculo.us
tags: []
meta:
  _edit_last: '530919'
  _oembed_322f27355e34fbdb227384b523fdc493: "{{unknown}}"
  _oembed_4160bf24fbc58e7b4d52bd89e2feeb3a: "{{unknown}}"
  _oembed_8217e5ed1f9e16de063dc4ec15a87a0f: "{{unknown}}"
  _oembed_eaecfcbfe3c32b192c5dfd3781567416: "{{unknown}}"
author:
  login: bburcham
  email: bill.burcham@gmail.com
  display_name: Bill Burcham
  first_name: ''
  last_name: ''
---
<p style="padding-left:30px;"><strong>update</strong>: July 5, 2007: see <a href="/2007/07/05/id-proliferation-eradication-technique-1-leverage-pageselect-with-pageinsert/">ID Proliferation Eradication Technique #1â€¦</a> for an update.</p>
<p><img style="float:left;" src="{{ site.baseurl }}/assets/logo-home.gif" alt="" /></p>
<p>The <a href="http://www.prototypejs.org/">Prototype</a> Updater constructor takes an Element (object) or element id (String) as the first parameter. You can see this in prototype.js in Abstract.Insertion.initialize and Ajax.Updater.updateContent . In both situations the first parameter sent to the constructor has $() applied before use. And as I'm sure you're aware, the effect of that is that if the parameter is an Element, then the same element is returned. OTOH, if the element is a String, then that string is assumed to be an element id and the Element is found in the DOM and returned.</p>
<p>The big deal here is that the <span style="font-weight:bold;"><a href="http://www.prototypejs.org/api">documentation</a> lies</span> or at a minimum fails to make this point clearly. Have a look at prototype-api.pdf. And this misunderstanding is carried forward in the <a href="http://caboo.se/doc/classes/ActionView/Helpers/PrototypeHelper/JavaScriptGenerator/GeneratorMethods.html">Rails wrapper API</a> functionality ActionView::Helpers::PrototypeHelper::JavaScriptGenerator::GeneratorMethods#<a href="http://caboo.se/doc/classes/ActionView/Helpers/PrototypeHelper/JavaScriptGenerator/GeneratorMethods.html#M005078">insert_html</a>, <a href="http://caboo.se/doc/classes/ActionView/Helpers/PrototypeHelper/JavaScriptGenerator/GeneratorMethods.html#M005079">replace_html</a>, remove, show, hide, and visual_effect. The result of this misunderstanding is that many JavaScript programmers think they need id's all over the place -- and Rails programmers actually <em>do</em> need id's all over the place (unless and until the API is repaired...)</p>
<div>What is wanted in the Ruby wrapper, in order to expose the full capability of the underlying JavaScript libraries, is the ability to pass not only a String (containing an Element id) but optionally to pass an instance of JavaScriptGenerator to insert_html and replace_html and to have that generator rendered. Then we could do (borrowing from the Rails doc and extending...):</div>
<pre class="textmate-source twilight"><span class="linenum">    1</span> <span class="source source_ruby source_ruby_rails">update_page <span class="keyword keyword_control keyword_control_ruby keyword_control_ruby_start-block">do </span>|page|
<span class="linenum">    2</span>   page.insert_html <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby">:bottom</span>, page.select(<span class="string string_quoted string_quoted_single string_quoted_single_ruby">'p.welcome b'</span>).first, <span class="string string_quoted string_quoted_double string_quoted_double_ruby">"&lt;li&gt;<span class="source source_ruby source_ruby_embedded source_ruby_embedded_source">#{<span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby">@item</span>.name}</span>&lt;/li&gt;"</span>
<span class="linenum">    3</span>   page.visual_effect <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby">:highlight</span>, <span class="string string_quoted string_quoted_single string_quoted_single_ruby">'list'</span>
<span class="linenum">    4</span>   page.hide <span class="string string_quoted string_quoted_single string_quoted_single_ruby">'status-indicator'</span>, <span class="string string_quoted string_quoted_single string_quoted_single_ruby">'cancel-link'</span>
<span class="linenum">    5</span> <span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>
<p>Note that instead of the simple string literal 'list' (from the Rails doc) we've got a full-fledged expression there. And generate something like this:</p>
<pre class="textmate-source twilight"><span class="linenum">    1</span> <span class="source source_ruby source_ruby_rails"><span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span> <span class="variable variable_other variable_other_constant variable_other_constant_ruby">Insertion</span>.<span class="variable variable_other variable_other_constant variable_other_constant_ruby">Bottom</span>(<span class="variable variable_other variable_other_readwrite variable_other_readwrite_global variable_other_readwrite_global_pre-defined variable_other_readwrite_global_pre-defined_ruby">$$</span>(<span class="string string_quoted string_quoted_single string_quoted_single_ruby">'p.welcome b'</span>).first, <span class="string string_quoted string_quoted_double string_quoted_double_ruby">"&lt;li&gt;Some item&lt;/li&gt;"</span>);
<span class="linenum">    2</span> <span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span> <span class="variable variable_other variable_other_constant variable_other_constant_ruby">Effect</span>.<span class="variable variable_other variable_other_constant variable_other_constant_ruby">Highlight</span>(<span class="variable variable_other variable_other_readwrite variable_other_readwrite_global variable_other_readwrite_global_pre-defined variable_other_readwrite_global_pre-defined_ruby">'list'</span>);
<span class="linenum">    3</span> [<span class="string string_quoted string_quoted_double string_quoted_double_ruby">"status-indicator"</span>, <span class="string string_quoted string_quoted_double string_quoted_double_ruby">"cancel-link"</span>].each(<span class="variable variable_other variable_other_constant variable_other_constant_ruby">Element</span>.hide);</span></pre>
<p>But really, the proposed change to the Ruby wrapper isn't limited to CSS selectors of course. Once insert_html, replace_html and friends support a full-fledged generator parameter, you could put arbitrary JavaScript in there. The most obvious examples would be calling custom functions and DOM traversal functions.</p>
